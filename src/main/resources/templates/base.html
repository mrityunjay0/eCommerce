<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.thymeleaf.org"
        th:fragment="layout(content)"
>
<head>
    <meta charset="UTF-8" />
    <title>Ecom Store</title>

    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
            crossorigin="anonymous"
    />
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
            rel="stylesheet"
            integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/css/style.css" />

</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"
        ><i class="fa-solid fa-cart-shopping"></i> Ecom Store</a
        >
        <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/"
                    ><i class="fa-solid fa-house"></i> Home</a
                    >
                </li>

                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/products"
                    >Products</a
                    >
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        Categories
                    </a>
                    <ul class="dropdown-menu">
                        <li th:each="c:${categories}"><a class="dropdown-item"
                        th:href="@{'/products?category='+${c.name}}">[[${c.name}]]</a></li>

                    </ul>
                </li>
            </ul>

            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <!-- Guest -->
                <th:block th:if="${user == null or user.name == 'Guest'}">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="guestMenu" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            Guest
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="guestMenu">
                            <li><a class="dropdown-item" href="/signin"><i class="fa-solid fa-right-to-bracket"></i> Login</a></li>
                            <li><a class="dropdown-item" href="/register"><i class="fa-solid fa-user-plus"></i> Register</a></li>
                            <li><a class="dropdown-item" href="/admin/"><i class="fa-solid fa-user-shield"></i> Admin</a></li>
                        </ul>
                    </li>
                </th:block>

                <!-- Logged-in non-admin -->
                <th:block th:if="${user != null and user.name != 'Guest' and user.name != 'Admin'}">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <!-- Profile image -->
                            <img th:src="@{'/img/profile_img/' + ${user.profileImage}}"
                                 alt="Profile"
                                 class="rounded-circle me-2"
                                 style="width:30px; height:30px; object-fit:cover;">
                            <span>[[${user.name}]]</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">

                            <li>
                                <a class="dropdown-item" th:href="@{/user/cart}">
                                    <i class="fa-solid fa-cart-shopping"></i> My Cart
                                    <span class="badge bg-secondary ms-2" th:text="${cartCount}">0</span>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>

                            <li>
                            <!-- POST logout is recommended -->
                                <form th:action="@{/logout}" method="post" class="px-3 py-1">
                                    <input type="hidden" th:if="${_csrf != null}"
                                           th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit" class="btn btn-danger btn-sm w-100">
                                        Logout <i class="fa-solid fa-right-from-bracket"></i>
                                    </button>
                                </form>
                            <li>
<!--                            <a class="dropdown-item" href="/logout">-->
<!--                                <i class="btn btn-danger btn-sm rounded-pill ms-2"></i> Logout</a>-->
<!--                            </li>-->

                            </li>
                        </ul>
                    </li>
                </th:block>

                <!-- Admin -->
                <th:block th:if="${user != null and user.name == 'Admin'}">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="adminMenu" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <!-- Profile image -->
                            <img th:src="@{'/img/profile_img/' + ${user.profileImage}}"
                                 alt="Profile"
                                 class="rounded-circle me-2"
                                 style="width:30px; height:30px; object-fit:cover;">
                            <span>[[${user.name}]]</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminMenu">
                            <li><a class="dropdown-item" href="/admin/"><i class="fa-solid fa-user-shield"></i> Admin Panel</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form th:action="@{/logout}" method="post" class="px-3 py-1">
                                    <input type="hidden" th:if="${_csrf != null}"
                                           th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit" class="btn btn-danger btn-sm w-100">
                                        Logout <i class="fa-solid fa-right-from-bracket"></i>
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </th:block>
            </ul>

        </div>
    </div>
</nav>
<!-- NAVBAR END -->

<div th:replace="${content}"></div> <!--This will include the content of the child templates-->

<!-- FOOTER -->
    <div class="container-fluid p-1 bg-primary text-center text-white mt-2">
        <p>ecom.com</p>
        <p class="mb-0">All Right Reserved @Ecom Store 2025</p>
    </div>
<!-- FOOTER END -->

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"
></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js"
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const alerts = document.querySelectorAll('.alert');

        alerts.forEach(function(alert) {
            setTimeout(function() {
                alert.classList.remove('show'); // Start fade out
                alert.classList.add('fade');

                setTimeout(() => {
                    alert.remove();
                }, 500);
            }, 4000);
        });
    });
</script>

</body>
</html>